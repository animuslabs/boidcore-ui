<template lang="pug">
q-page(padding)
  .centered
    h2 Boid Status
  .centered.q-gutter-md
    q-card.q-pa-md
      .centered
        h3.text-weight-light {{ currentRound }}
      .centered
        p.text-weight-thin Current Round
    q-card.q-pa-md
      .centered
        h5.text-weight-light {{ timeUntilNextRound }}
      .centered
        p.text-weight-thin Next Round Starts
    q-card.q-pa-md
      .centered
        h5.text-weight-light {{ sys.global.total_power.toString() }}
      .centered
        p.text-weight-thin Total Boid Power
    q-card.q-pa-md
      .centered
        h5.text-weight-light {{ Object.entries(sys.accounts).length }}
      .centered
        p.text-weight-thin Total Members
  .centered
  .centered.q-mt-md
    q-card(style="width:1200px; max-width:90vw").q-pa-md
      .centered.q-ma-md
        .full-width.q-pa-md(style="border-radius: 15px;")
          .centered
            h2 What is boid
          p Boid allows you to contribute your computing power towards important scientific research, earn rewards, and compete against others from around the world. Learn more about boid at #[a(href="https://docs.boid.com" target="_blank").text-warning.text-hover-primary docs.boid.com].
      q-separator
      .centered.q-mt-md
        h2 Getting Started
      .row
        .col-auto
          div.q-pa-md
            .row.items-center.no-wrap.q-gutter-md
              h2 1
              div.q-pl-lg
                h4 Create a Boid Account
                p There is two ways to create a Boid account.
                ul
                  li
                    p Use an invite link from an existing Boid User. You can meet other boid users on the official #[a(href="https://t.me/boidcommunity" target="_blank") Boid Telegram channel].
                  li
                    p Purchase a Boid Account directly on the #[a(href="/join") join] page.

        .col-auto
          div.q-pa-md
            .row.items-center.no-wrap.q-gutter-md
              h2 2
              div.q-pa-lg
                h4 Join Folding@Home
                p After you have created your Boid Account you should link it to Folding@Home. Follow the #[a(href="https://docs.boid.com/boidcore/modules/folding" target="_blank") F@H Setup instructions].
        .col-auto
          div.q-pa-md
            .row.items-center.no-wrap.q-gutter-md
              h2 3
              div.q-pa-lg
                h4 Keep Folding@Home running
                p Double check that your Boid ID is used as the user account in the Folding@Home application and you are on the boid.com team. Allow the application to run on your computer at least a few hours per day. The longer the application runs the more Boid Power you can generate. You can view your current Boid Power on the Accounts page.
        .col-auto
          div.q-pa-md
            .row.items-center.no-wrap.q-gutter-md
              h2 4
              div.q-pa-lg
                h4 Watch your account power up
                p Track your progress on the team leaderboard. Your account will receive BOID tokens over time based on your Boid Power. The tokens are automatically staked to your account which increases your BOID token earning rate.
        .col-auto
          div.q-pa-md
            .row.items-center.no-wrap.q-gutter-md
              h2 5
              div.q-pa-lg
                h4 Explore Boid
                ul
                  li
                    p You can unstake, delegate, transfer some BOID on the #[a(href="/wallet") Wallet] page.
                  li
                    p  On the #[a(href="/offer") Offers] page you can activate Power Boosters. Boosters can give you additional power over time or multiply your exisitng power.
                  li
                    p If you purchased a Boid Gold Account or upgraded from a sponsored account you can purchase invites and generate invite links to share with others, you earn a percentage of the power generated by all accounts you invite. You also get paid when someone you invites pays the account upgrade fee.
    div(style="height: 20px;").full-width
</template>

<script lang="ts">
import { Todo, Meta } from "components/models"
import ExampleComponent from "components/ExampleComponent.vue"
import { defineComponent } from "vue"
import { currentRound, currentRoundProgress, getTimeData } from "src/lib/util"
import { sysTables } from "src/stores/sysTables"
import timethat from "timethat"
let interval:null|ReturnType<typeof setInterval> = null
export default defineComponent({
  name: "IndexPage",
  components: { ExampleComponent },
  data() {
    return {
      sys: sysTables(),
      currentRound: currentRound(),
      timeUntilNextRound: "loading..."
    }
  },
  async mounted() {
    await this.sys.loadConfig()
    await this.sys.loadGlobal()
    await this.sys.loadAccounts()
    this.currentRound = currentRound()
    this.timeUntilNextRound = this.calcTimeUntilNextRound()
    interval = setInterval(() => {
      this.timeUntilNextRound = this.calcTimeUntilNextRound()
      this.currentRound = currentRound()
      this.sys.loadGlobal()
      this.sys.loadAccounts()
    }, 1000 * 30)
  },
  unmounted() {
    if (interval) clearInterval(interval)
  },
  methods: {
    calcTimeUntilNextRound():string {
      const progress = currentRoundProgress() % 1
      const timeElapsed = getTimeData().roundLengthMs * progress
      const timeRemaining = getTimeData().roundLengthMs - timeElapsed
      const endDate = new Date(Date.now() + timeRemaining)

      const text:string = timethat.calc(new Date(), endDate)
      const trimmed = text.split(",").splice(0, 2)
      return trimmed.join()
    }
  }
})
</script>
